<html>
<head>
    <title>角色信息</title>
    <link rel="stylesheet" type="text/css"
          href="../easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../easyui/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../easyui/demo/demo.css">
    <script type="text/javascript" src="../easyui/jquery.min.js"></script>
    <script type="text/javascript" src="../easyui/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../easyui/locale/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript">
        function query() {
            var roleName = $("#qroleName").textbox("getValue");
            $("#dg").datagrid("load", {roleName: roleName});
        }

        // 打开保存或者更新窗口
        function saveOrUpdate(type) {
            $('#window').window({
                width: 400,
                height: 220,
                modal: true
            });
            $("#id").val("");
            $("#roleName").textbox("setValue", "");
            $("#note").textbox("setValue", "");
            var role = $("#dg").datagrid("getSelected");
            if (role == null && type == "update") {
                alert("没有选择角色信息");
                return;
            }
            $("#url").val("./" + type);
            if (type == "update") {
                // 通过get请求获取数据
                $.get("./" + role.id, function (role) {
                    $("#id").val(role.id);
                    $("#roleName").textbox("setValue", role.roleName);
                    $("#note").textbox("setValue", role.note);
                });
            }
            $('#window').window('open');
        }

        // 提交保存路径
        function submit() {
            // 编号
            var id = $("#id").val();
            // 角色对象信息
            var role = {
                roleName: $("#roleName").textbox("getValue"),
                note: $("#note").textbox("getValue")
            };
            // 如果存在id，则加入id内容
            if (id != null) {
                role["id"] = id;
            }
            // 请求路径
            var url = $("#url").val();
            // Ajax请求
            $.ajax({
                url: url,
                // POST请求
                type: "POST",
                // 转换为JSON字符串，作为请求体提交后端
                data: JSON.stringify(role),
                // 声明请求体为JSON媒体类型
                contentType: "application/json",
                // 处理请求体结果
                success: function (result) {
                    alert("保存成功");
                    $("#dg").datagrid("reload");
                    $('#window').window('close');
                }
            });
        }

        function remove() {
            var role = $("#dg").datagrid("getSelected");
            if (role == null) {
                alert("没有选择角色信息");
                return;
            }
            var selectResult = confirm("您确定删除角色信息吗？");
            if (selectResult) {
                $.ajax({
                    url: "./" + role.id,
                    type: "DELETE",
                    success: function (result) {
                        alert("删除成功");
                        $("#dg").datagrid("reload");
                    }
                });
            }
        }
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>
<body>
<div class="easyui-layout" style="width: 100%; height: 100%;">
    <div data-options="region:'north', iconCls:'icon-ok'" title="查询框" style="height: 80px;">
        <table>
            <tr>
                <td>&nbsp;&nbsp;角色名称：</td>
                <td><input name="qroleName" id="qroleName" class="easyui-textbox" style="width:100%;height:32px"></td>
                <td><a href="#" onclick="query()" class="easyui-linkbutton" data-options="iconCls:'icon-search'"
                       style="width:80px">查询</a></td>
            </tr>
        </table>
    </div>
    <div data-options="region:'center', iconCls:'icon-ok'">
        <table id="dg" style="height: 100%; width: 100%" class="easyui-datagrid" title="角色列表"
               data-options="singleSelect:true,collapsible:true,
			        url: '../roles', method: 'post',
			        fitColumns:true, pagination:true, pageNumber:1, pageSize:20">
            <thead>
            <tr>
                <th data-options="field:'id',width:100">编号</th>
                <th data-options="field:'roleName',width:100">角色名称</th>
                <th data-options="field:'note',width:200">备注</th>
            </tr>
            </thead>
        </table>
    </div>
    <div style="padding:5px 0;" data-options="region:'south', iconCls:'icon-ok'">
        <a href="#" class="easyui-linkbutton" onclick="saveOrUpdate('add');" data-options="iconCls:'icon-add'">新增</a>
        <a href="#" class="easyui-linkbutton" onclick="saveOrUpdate('update');"
           data-options="iconCls:'icon-edit'">修改</a>
        <a href="#" class="easyui-linkbutton" onclick="remove();" data-options="iconCls:'icon-remove'">删除</a>
    </div>
</div>
<div id="window" class="easyui-window" title="角色详情" data-options="modal:true,closed:true,iconCls:'icon-save'"
     style="width:0px;height:0px;padding:0px;">
    <div class="easyui-layout" data-options="fit:true">
        <div data-options="region:'center'" style="padding:10px;">
            <form id="role_details" method="post">
                <input name="id" id="id" type="hidden">
                <input name="url" id="url" type="hidden">
                <table>
                    <tr>
                        <td>角色名称</td>
                        <td><input name="roleName" id="roleName" data-options="prompt:'角色名称.....'"
                                   class="easyui-textbox" style="width:100%;height:32px"></td>
                    </tr>
                    <tr>
                        <td>备注</td>
                        <td><input name="note" id="note" data-options="prompt:'备注信息.....'" class="easyui-textbox"
                                   style="width:100%;height:32px"></td>
                    </tr>
                </table>
            </form>
        </div>
        <div data-options="region:'south',border:false" style="text-align:right;padding:5px 0 0;">
            <a class="easyui-linkbutton" data-options="iconCls:'icon-save'" href="javascript:void(0)"
               onclick="javascript:submit()" style="width:80px">保存</a>
            <a class="easyui-linkbutton" data-options="iconCls:'icon-cancel'" href="javascript:void(0)"
               onclick="javascript:$('#window').window('close');" style="width:80px">关闭</a>
        </div>
    </div>
</div>
</body>
</html>